---
title: "Making Graphs in R Using ggplot2: Part 1"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    df_print: default
runtime: shiny_prerendered
description: >
  Learn about the basic syntax of R.
---

## Overview

![](https://youtu.be/lbt4BH9Q82E)

In this session we will start looking at one of the most widely used, and almost universally useful, applications of the R programming languages - data visualisation. We will do this by learning specifically about the plotting library `ggplot2`. There are three parts to this workbook, as well as a series of exercises and questions. You can complete the workbooks at your own pace, across multiple sessions, although note that progress through each part of the workbook only saves if you are using the same device. However you can skip back and forth at any point within each part using the navigation menu.

### Installing the ggplot2 package
As mentioned in the video, this is not the default plotting library within R - but an additional package which needs to be installed separately. We will learn more about installing packages a bit later in the course, but an important thing to remember is that when you are using RStudio or R, to make sure you have downloaded the package first,using `install.packages("ggplot2")`, and that you have loaded the package for the session, using `library(ggplot2)`. The package has already been pre-loaded into this workbook.

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(knitr)
tutorial_options(exercise.timelimit = 10)
BeanSurvey<-read.csv("bean_survey.csv")[,-1]

BeanSurvey$AGEHH<-c(32,57,20,55,78,42,28,49,41,54,65,63,32,29,43,68,53,39,25,44,23,47,32,26,25,29,44,23,58,69,26,65,75,51,38,24,35,29,37,45,50,23,60,32,70,43,51,28,65,33)


BeanSurvey<-mutate(BeanSurvey,GENDERHH=ifelse(is.na(GENDERHH),"male",as.character(GENDERHH)))


```



## 'BeanSurvey' dataset 

The data we are using in this session is an extract of a survey conducted in Uganda from farmers identified as growing beans.

The dataset contains an extract of 50 responses to 23 of the survey questions, and has been imported to R as a data frame called `BeanSurvey`.

A summary of the columns in the dataset is below.

```{r data1, echo=FALSE,message=FALSE,warning=FALSE}


data.frame(Column=colnames(BeanSurvey),
           Description=c("Farmer ID","Village name","Household composition","Gender of Household Head","Age of Household Head",
                         "Occupation of Household Head","Number of Adults within the household","Number of Children (<18) within the household","Do they grow matoke?",
                         "Do they grow maize?","Do they grow beans?","Do they grow banana?","Do they grow cassava?",
                         "Do they grow coffee?","Land area of farm (acres)","Labor usage","Intercrops with beans",
                         "Household decision responsibility","Do they grow beans for sale?","Quantity of beans planted in long rain season",
                         "Quantity of beans planted in short rain season","Quantity of beans harvested in long rain season"
                         ,"Quantity of beans harvested in short rain season")) %>% kable()

```


Spend some time looking through the exploring the full dataset embedded below, to familiarise yourself with the columns and the type of data stored within each column. You may need to refer back to this data at times during this tutorial. Remember that R is case sensitive, so you will always have to refer to the variables in this dataset exactly as they are written in the data. There is a column in this data called "GENDERHH" but there is no column in this data called "GenderHH".

```{r data2,echo=FALSE}
DT::datatable(BeanSurvey)
```

(You can use the arrow keys on your keyboard to scroll right in case the data table does not fit entirely on your screen)

## First Plot

To start off we are going to look at producing some plots with just one variable at a time. Let's start with a simple bar chart showing the frequency of different villages within the dataset. The code has been written for you in the chunk below. Press "Run Code" in the chunk below to see the resulting plot.

```{r two_one,exercise=TRUE}
ggplot(data = BeanSurvey,  aes(x = VILLAGE)) + 
  geom_bar()
```

Easy! Well, maybe not at first, since some of the commands we're using in that chunk look a bit strange. Let's start taking a look at each of the components within that code to understand what they all do.

## Data

Let's break down each of the different parts of this command.

With ggplot2, you always begin a graph with the function `ggplot()`. This function provides the information which will be passed to all subsequent functions making up the plot - about the data and the aesthetic mapping being used. 
And to make a plot you need some data, all ggplots must be made from an object of class data frame (or tibble) - we cannot plot anything which does not live inside of one of these data objects. 
So the first thing that we need to specify in the function is what data frame we are using. In this case the data frame we are using has been assigned the name `BeanSurvey`.

And we could just finish our code at this point and run this chunk of code, it is a valid and complete piece of code.

```{r data1,exercise=TRUE}
ggplot(data = BeanSurvey)
```

But it is totally useless by itself! We have told R to make a plot from the `BeanSurvey` data, but we have not told it what variables from the data we want to plot, or how we want to plot them. So we get a completely blank canvas returned to us.

This will lead us to specifying the two most important components of the ggplot - what variables we want to plot (the "aesthetic mapping") and how we want to plot them (the "geometries"). Every ggplot you will ever make will require you to specify as a minimum, the data, the aesthetics and the geometries. Everything else beyond that point is, to a certain degree, optional as there are default settings which are applied.


## Aesthetic Mapping

If we go back to the original code we saw the part of the code which said `aes(x = VILLAGE)`. 'aes' is the abbreviation for aesthetics. This is the word used to describe the different components of the plot onto which we can map different variables from our data.
When thinking of most straightforward graphs the obvious aesthetics are the x axis and y axis. But we will also learn more about other aesthetics later, as we can also use our data to define colours, size of points, shapes, labels and so on. There are some plot types, like bar charts, we only need to specify one aesthetic as a minimum. So we can map the column `VILLAGE` on to the x aesthetic of our graph in preparation for making a single bar chart.

Again, we can run just this line on its own:

```{r aes1,exercise=TRUE}
ggplot(data = BeanSurvey, aes(x = VILLAGE))
```

You will see this is also a blank canvas, as before, except this time the x axis has been labeled and plotted based on the unique values of the column `VILLAGE` from our dataset `BeanSurvey`. 

This whole line has now build up the page on which we will draw a plot. But we need to tell R exactly how it should draw a plot which we do by setting a geometry. 

## Geometries   

All geometry types are functions `geom_xxx` where the `xxx` is replaced by the shorthand for the plot type that you want to make. The geom function we want to use now for a bar chart is `geom_bar`

When we write the code for a ggplot, we think in terms of layering all of these different functions on top of each other. Each of the functions form a layer which are sequentially added to the plot.
The canvas we have just set is one layer; the bars will be another layer. The components are separated using a `+`, and it is usually conventional to start a new line for each new layer, as this makes your code easier to read.

```{r aes2,exercise=TRUE}
ggplot(data = BeanSurvey,  aes(x = VILLAGE)) + 
  geom_bar()
```

Note that the `+` must be placed at the end of the line, not at the beginning of the new line. If you forget to put the plus at the end of the line, R will see a complete and valid piece of code and run this, and then ignore anything which comes afterwards (usually giving a warning or error while doing so).

The y axis for `geom_bar`, by default, becomes the frequency of each unique category within the variable mapped to our x aesthetic. So from the plot we can see that in our survey we interviewed farmers from two villages, Kimbugu and Lwala, and that there were slightly more farmers interviewed in Lwala compared to Kimbugu.

**Question: Modify the code to make a bar chart of `AGEHH` instead of `VILLAGE`**
```{r AgePlot,exercise=TRUE}
ggplot(data = BeanSurvey,  aes(x = VILLAGE)) + 
  geom_bar()
```

```{r AgePlot-solution}
ggplot(data = BeanSurvey,  aes(x = AGEHH)) + 
  geom_bar()
```